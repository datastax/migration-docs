= Create the target environment for your migration

In this topic, we'll use a DataStax Astra DB serverless database as the Target cluster. However, you can choose a different target such as a more recent release of Cassandra 4.0.x or DSE 6.8.x.

== Overview

* Create an Astra DB serverless cluster
* Retrieve its Secure Connect Bundle (SCB) and upload it to the application instances
* Create Astra DB access credentials for the cluster
* Create the client application schema

== Prerequisites

* Access to https://astra.datastax.com[Astra Portal, window="_blank"] on astra.datastax.com.

== Create an Astra DB serverless cluster

Log into the Astra console and create a Serverless Astra DB database. You can start with a Free plan, but consider upgrading during your migration project to an Astra DB Pay As You Go (PAYG) or Enterprise plan, to take advantage of additional functionality -- such as Exporting Metrics to external third-party apps, Bring Your Own Keys, and other features.

The PAYG and Enterprise plans have many benefits over the Free plan, such as the ability to lift rate limiting, and avoiding hibernation timeouts.

Assign your preferred values for the serverless database:

* **Name**
* **Keyspace** - this is a handle that establishes the database's context in subsequent DDL and DML statements
* **Cloud provider**: AWS is used in this guide's example; however you can choose your preferred cloud provider
* **Region**: choose your geographically preferred region - you can subsequently add more regions

When the Astra DB reaches **Active** status, perform the following steps in an Astra DB user account. Create an IAM token with the "Read/Write User" role. This role will be used by the client application, the {zdm-proxy}, and the {zdm-automation}.

In Astra Portal, choose **Organization Settings** (upper left) from the drop-down menu, and then **Token Management**.  Select the **Read/Write User** role:

image:zdm-token-management1.png[]

Then click **Generate Token**. Astra console displays the generated values. Example:

image:zdm-tokens-generated.png[]

Save all credentials (Client ID, Client Secret, and Token) in a clearly named file. For example, you can save all three parts of the new credentials to a file called `my_app_readwrite_user` and store it safely.

For more information about role permissions, see link:https://docs.datastax.com/en/astra/docs/manage/org/user-permissions.html[User permissions] in the Astra DB documentation.

== Get the Secure Connect Bundle and upload to client instances

Your cluster's Secure Connect Bundle (SCB) will be needed by:

* Your client application, to connect directly to Astra DB near the end of the migration
* Cassandra Data Migrator or DSBulk Migrator, to migrate and validate data into Astra DB

// * The DataStax Bulk Migrator to import the existing data into Astra

With the Astra DB database in an **Active** status, download its SCB from Astra Portal. It's a zip file that contains the security certificates and other metadata to connect to your database (note that the credentials are not contained in the SCB).

. In Astra Portal, go to the Dashboard and select the serverless database that you created in the prior step.
. Click on **Connect**
. Select the **Java driver** and click on **Download bundle**.
. Copy the SCB to your client application instance:
+
```bash
scp -i <your_ssh_key> secure-connect-<target cluster name>.zip ubuntu@<public IP of client application instance>:
```

== Create the client application schema

To complete the preparation work on Target, create the client application schema in your newly created Astra DB database.

In Astra Portal, create each corresponding keyspace and tables. The keyspace names, table names and structure must be identical to the schema on Origin, bearing in mind that:

* In Astra DB, keyspaces must be created through the UI [TODO add link?]. Keyspace creation through CQL is not supported.
* Tables can be defined as usual in regular CQL, but the only table property that can be optionally set in Astra DB is `default_time_to_live`. Please remove all other table properties (such as compaction strategy, `gc_grace_seconds` and so on).
* Materialized Views (MVs) and certain types of indexes are not supported in Astra DB, and should be replaced with supported indexes. See link:https://docs.datastax.com/en/astra-serverless/docs/plan/planning.html#_serverless_database_limits[Serverless database limits] for more details

To aid you in preparing the schema from the DDL used in a non-Astra cluster, you may wish to consider the `generate-ddl` functionality in the link:https://github.com/datastax/dsbulk-migrator[DSBulk Migrator]. Note that Materialized Views and indexes are not automatically converted by this tool.


